repositories:
  - name: mangata
    url: git+https://github.com/mangata-finance/helm-charts@charts?ref=feat/MGX-241-node-chart

environments:
  dev:
    values:
      - "./config/dev.yaml"
  fungible:
    values:
      - "./config/fungible.yaml"
  rococo:
    values:
      - "./config/rococo.yaml"

helmDefaults:
  wait: true

releases:
  - name: relaychain
    installed: {{ .Values.enableLocalRelaychain | toYaml }}
    namespace: '{{ requiredEnv "ENVIRONMENT" }}'
    chart: mangata/relaychain-testnet
    values:
      - env: {{ requiredEnv "ENVIRONMENT" | quote }}
        storageSize: {{ .Values.relaychainStorageSize }}
        remoteCluster: true
  - name: node-01
    namespace: '{{ requiredEnv "ENVIRONMENT" }}'
    # chart: mangata/node
    chart: /Users/tenequm/Projects/helm-charts-m/charts/node
    values:
      - env: {{ requiredEnv "ENVIRONMENT" | quote }}
        image:
          tag: {{ requiredEnv "IMAGE_TAG" | quote }}
        remoteCluster: true
        relaychain:
          storageSize: {{ .Values.relaychainStorageSize }}
          customChainspecUrl: {{ .Values.relaychainCustomChainspecUrl | quote }}
        node:
          isCollator: {{ .Values.node01.isCollator | toYaml }}
          bootnodeAddr: {{ .Values.followerBootnodeAddr | quote }}
          customChainspecUrl: {{ .Values.nodeCustomChainspecUrl | quote }}
          storageSize: {{ .Values.storageSize }}
          parachainRegisterSidecar:
            enable: {{ .Values.enableParachainRegisterSidecar | toYaml }}
          customNodeKey: {{ .Values.node01.nodeKey | quote }}
          accountKeys:
            - type: aura
              scheme: sr25519
              seed: {{ .Values.node01.accountKeySeed | fetchSecretValue | quote }}
        resources:
          requests:
            cpu: '8.0'
            memory: 16Gi
          limits:
            cpu: '8.0'
            memory: 16Gi
  - name: node-02
    namespace: '{{ requiredEnv "ENVIRONMENT" }}'
    # chart: mangata/node
    chart: /Users/tenequm/Projects/helm-charts-m/charts/node
    values:
      - env: {{ requiredEnv "ENVIRONMENT" | quote }}
        image:
          tag: {{ requiredEnv "IMAGE_TAG" | quote }}
        remoteCluster: true
        relaychain:
          storageSize: {{ .Values.relaychainStorageSize }}
          customChainspecUrl: {{ .Values.relaychainCustomChainspecUrl | quote }}
        node:
          isCollator: {{ .Values.node02.isCollator | toYaml }}
          bootnodeAddr: {{ .Values.followerBootnodeAddr | quote }}
          customChainspecUrl: {{ .Values.nodeCustomChainspecUrl | quote }}
          storageSize: {{ .Values.storageSize }}
          parachainRegisterSidecar:
            enable: false
          customNodeKey: {{ .Values.node02.nodeKey | quote }}
          accountKeys:
            - type: aura
              scheme: sr25519
              seed: {{ .Values.node02.accountKeySeed | fetchSecretValue | quote }}
        resources:
          requests:
            cpu: '8.0'
            memory: 16Gi
          limits:
            cpu: '8.0'
            memory: 16Gi
  - name: node-03
    installed: {{ .Values | get "node03.enabled" }}
    namespace: '{{ requiredEnv "ENVIRONMENT" }}'
    # chart: mangata/node
    chart: /Users/tenequm/Projects/helm-charts-m/charts/node
    values:
      - env: {{ requiredEnv "ENVIRONMENT" | quote }}
        image:
          tag: {{ requiredEnv "IMAGE_TAG" | quote }}
        remoteCluster: true
        node:
          bootnodeAddr: {{ .Values.followerBootnodeAddr | quote }}
          storageSize: {{ .Values.storageSize }}
          relaychainStorageSize: {{ .Values.relaychainStorageSize }}
          parachainRegisterSidecar:
            enable: false
          customNodeKey: {{ .Values.node03.nodeKey | quote }}
          accountKeys:
            - type: aura
              scheme: sr25519
              seed: {{ .Values.node03.accountKeySeed | fetchSecretValue | quote }}
